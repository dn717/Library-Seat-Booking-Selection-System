# user login
protected void btn_submit_Click(object sender, EventArgs e)
    {
        string UserName = this.TextBox1.Text.Trim().Replace("'", "");
        string Upasswork = this.TextBox2.Text.Trim().Replace("'", ""); 
        Users admin = new UsersService().Get_Objec("UserName='" + UserName + "' and Upassword='" + Upasswork + "'");//调用UsersService类的Get_Object方法调取数据库Usere表中的字段信息
      Users username = new UsersService().Get_Objec("UserName='"+UserName+"'");

       if (admin != null)
        {
            Session["Admin"] = admin;
            Session.Timeout = 60000; //设置Session的过期时间

            if (admin.Type == 0)//管理员类型值为0，学生为1
            {
                Response.Redirect("index.aspx");
            }
            else
            {
                Response.Redirect("Node/Default.aspx");
            }
        }
        else
        {
            
   Response.Write("<script>alert('用户名或密码不正确！请重新填写！')</script>");
        }

}

#Book a seat
protected void Button2_Click(object sender, EventArgs e)//预定按钮点击事件
    {
        if (textbox1.Text == ""&&lbl_xzzw.Text=="")
        {
            Page.ClientScript.RegisterStartupScript(this.GetType(), "提示信息", "<script>alert('预定时间或座位不能为空')</script>");
        }
        else
        {
            SeatChoosingService myseatchoosingService = new SeatChoosingService();//为类SeatChoosingService声明新的对象
            SeatChoosing myseatchoosing = new SeatChoosing();//为类SeatChoosing声明新的对象


            myseatchoosing.UserName = Session["UserName"].ToString();
            myseatchoosing.Time = DateTime.Parse(textbox1.Text);
            myseatchoosing.Rid = Lable1.Text;
            myseatchoosing.Sid = Convert.ToInt32(lbl_xzzw.Text);
            int status = new SeatService().Get_Status("Sid='" + lbl_xzzw.Text + "'");//调用SeatService类的Get_Status函数获取当前座位的状态
            if (status == 1 || status == 2)
            {
                Page.RegisterStartupScript("", "<script>alert('该座位已经预定或占座！');</script>");
            }
            else
            {
                DateTime t1 = DateTime.Parse(textbox1.Text);
                DateTime t2 = DateTime.Parse(lable_time.Text);
                if (t1 > t2)
                {
                    System.TimeSpan t3 = t1.Subtract(t2);//t1和t2时间之差
                    double n = t3.TotalHours;
                    if (n > 2)
                    {
                        Page.RegisterStartupScript("", "<script>alert('预定时间超过2小时！');</script>");
                    }
                    else
                    {
                        bool b = new SeatChoosingService().Add(myseatchoosing);//调用SeatChoosingService类的Add函数将myseatchoosing变量加入到表Seat_choosing中
                        if (b)
                        {
                            Page.RegisterStartupScript("", "<script>alert('成功预定座位！');</script>");
                            Seat seat = new Seat();
                            seat.Status = 1;
                            seat.Rid = Lable1.Text;
                            seat.Sid = Convert.ToInt32(lbl_xzzw.Text);
                            bool s = new SeatService().ModifyStatus(seat);//调用SeatService类的ModifyStatus函数将当前seat的状态改为1
                        }
                        else
                        {
                            Page.RegisterStartupScript("", "<script>alert('未成功预定座位！');</script>");
                        }

                    }
                }
                else
                {
                    Page.RegisterStartupScript("", "<script>alert('预定时间小于当前时间！');</script>");
                }
            }
        }

         Response.AddHeader("Refresh", "0");//页面刷新  

